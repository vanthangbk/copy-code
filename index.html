<!DOCTYPE html>  
<html>  
<head>  
  <title>Hiển thị Kết Quả Dạng Code</title>  
  <style>  
    body {  
      font-family: Arial, sans-serif;  
      margin: 20px;
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }  
    label {  
      display: block;  
      margin-bottom: 5px;
      font-weight: bold;  
    }  
    textarea, input[type="text"], input[type="number"] {  
      width: 100%;  
      padding: 10px;  
      margin-bottom: 15px;  
      border: 1px solid #ddd;  
      border-radius: 4px;  
      box-sizing: border-box;
      transition: border-color 0.3s;
    }
    textarea:focus, input:focus {
      border-color: #4CAF50;
      outline: none;
    }
    .result-code {  
      margin-top: 20px;  
      border: 1px solid #ddd;  
      padding: 15px;  
      border-radius: 8px;  
      background-color: #f9f9f9;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }  
    pre {  
      background: #f1f1f1;  
      padding: 12px;  
      border-radius: 4px;  
      overflow-x: auto;
      margin: 0;
      border-left: 3px solid #4CAF50;
    }  
    .copy-btn {  
      margin-top: 10px;  
      padding: 8px 15px;  
      border: none;  
      background-color: #4CAF50;  
      color: white;  
      border-radius: 4px;  
      cursor: pointer;  
      transition: background-color 0.3s;
      font-weight: bold;
    }  
    .copy-btn:hover {  
      background-color: #45a049;  
    }
    button {
      padding: 10px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: bold;
    }
    button:hover {
      background-color: #45a049;
    }
    h1, h2, h3 {  
      color: #2c3e50;
      border-bottom: 2px solid #eee;
      padding-bottom: 5px; 
    }
    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .control-group {
      flex: 1;
      min-width: 250px;
    }
    .preview-section {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .preview-content {
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 4px;
      background-color: #fff;
      min-height: 100px;
    }
    .tabs {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #ddd;
    }
    .tab {
      padding: 8px 15px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      margin-right: 5px;
    }
    .tab.active {
      background-color: white;
      border-bottom: 2px solid white;
      font-weight: bold;
      color: #4CAF50;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .theme-switch {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
    }
    .dark-mode {
      background-color: #2c3e50;
      color: #ecf0f1;
    }
    .dark-mode .result-code, .dark-mode .preview-section {
      background-color: #34495e;
      border-color: #2c3e50;
    }
    .dark-mode pre {
      background-color: #2c3e50;
      border-left-color: #3498db;
    }
    .dark-mode .tab {
      background-color: #34495e;
      border-color: #2c3e50;
      color: #ecf0f1;
    }
    .dark-mode .tab.active {
      background-color: #2c3e50;
      color: #3498db;
    }
    .dark-mode h1, .dark-mode h2, .dark-mode h3 {
      color: #ecf0f1;
      border-bottom-color: #34495e;
    }
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
    }
    .history-panel {
      margin-top: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .history-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-item:hover {
      background-color: #f1f1f1;
    }
    .history-item:last-child {
      border-bottom: none;
    }
    .dark-mode .history-panel {
      background-color: #34495e;
      border-color: #2c3e50;
    }
    .dark-mode .history-item {
      border-bottom-color: #2c3e50;
    }
    .dark-mode .history-item:hover {
      background-color: #2c3e50;
    }
    .history-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
      gap: 10px;
    }
    .history-date {
      font-size: 0.8em;
      color: #777;
    }
    .dark-mode .history-date {
      color: #bbb;
    }
    .cookie-notice {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: rgba(0,0,0,0.8);
      color: white;
      padding: 15px;
      text-align: center;
      display: none;
      z-index: 100;
    }
    .cookie-notice button {
      margin-left: 10px;
    }
  </style>  
</head>  
<body>  
  <div class="theme-switch">
    <label for="darkMode">Chế độ tối:</label>
    <input type="checkbox" id="darkMode" onchange="toggleDarkMode()">
  </div>

  <div id="cookieNotice" class="cookie-notice">
    Trang web này sử dụng cookie để lưu lịch sử nhập liệu của bạn.
    <button onclick="acceptCookies()">Đồng ý</button>
  </div>

  <h1>Chèn Liên Kết & Hiển Thị Dạng Code</h1>  

  <div class="controls">
    <div class="control-group">
      <label for="limitedContent">Nhập nội dung:</label>  
      <textarea id="limitedContent" rows="5" placeholder="Nội dung này sẽ được thay thế từ khóa bằng liên kết"></textarea>  

      <label for="keyword">Từ khóa:</label>  
      <input type="text" id="keyword" placeholder="Nhập từ cần thay thế">  

      <label for="link">Link website:</label>  
      <input type="text" id="link" placeholder="Nhập link website">  
      
      <label for="linkLimit">Số lượng liên kết tối đa:</label>
      <input type="number" id="linkLimit" value="2" min="1" max="100">
      
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button onclick="generateLinks()">Tạo Liên Kết</button>
        <button onclick="saveToHistory()">Lưu Thiết Lập</button>
      </div>
    </div>

    <div class="control-group preview-section">
      <h3>Xem trước kết quả:</h3>
      <div class="preview-content" id="previewContent">
        Kết quả xem trước sẽ hiển thị ở đây...
      </div>
    </div>
  </div>

  <div class="history-panel">
    <h3>Lịch sử (Lưu tối đa 10 lần)</h3>
    <div id="historyItems">
      <!-- Các mục lịch sử sẽ được thêm vào đây bằng JavaScript -->
    </div>
    <div class="history-actions">
      <button onclick="clearHistory()">Xóa Tất Cả</button>
    </div>
  </div>

  <div class="result-code">  
    <h2>Kết quả (dạng Code):</h2>  

    <div class="tabs">
      <div class="tab active" onclick="switchTab('html')">HTML</div>
      <div class="tab" onclick="switchTab('markdown')">Markdown</div>
      <div class="tab" onclick="switchTab('bbcode')">BBCode</div>
      <div class="tab" onclick="switchTab('plain')">Plain URL</div>
    </div>

    <div class="tab-content active" id="html-tab">
      <pre><code id="htmlCodeOutput"></code></pre>  
      <button id="htmlCopyBtn" class="copy-btn" onclick="copyCode('htmlCodeOutput','htmlCopyBtn')">Copy Code</button>  
    </div>

    <div class="tab-content" id="markdown-tab">
      <pre><code id="markdownCodeOutput"></code></pre>  
      <button id="markdownCopyBtn" class="copy-btn" onclick="copyCode('markdownCodeOutput','markdownCopyBtn')">Copy Code</button>  
    </div>

    <div class="tab-content" id="bbcode-tab">
      <pre><code id="bbcodeCodeOutput"></code></pre>  
      <button id="bbcodeCopyBtn" class="copy-btn" onclick="copyCode('bbcodeCodeOutput','bbcodeCopyBtn')">Copy Code</button>  
    </div>

    <div class="tab-content" id="plain-tab">
      <pre><code id="plainCodeOutput"></code></pre>  
      <button id="plainCopyBtn" class="copy-btn" onclick="copyCode('plainCodeOutput','plainCopyBtn')">Copy Code</button>  
    </div>
  </div>  

  <script>  
    // Kiểm tra cookie khi trang tải xong
    window.onload = function() {
      document.getElementById("limitedContent").value = "Đây là một ví dụ về từ khóa và cách nó được thay thế bằng liên kết. Từ khóa này sẽ xuất hiện nhiều lần nhưng chỉ được thay thế một số lần.";
      document.getElementById("keyword").value = "từ khóa";
      document.getElementById("link").value = "https://example.com";
      
      // Kiểm tra xem người dùng đã chấp nhận cookie chưa
      if (!getCookie("cookiesAccepted")) {
        document.getElementById("cookieNotice").style.display = "block";
      }
      
      // Tải lịch sử từ cookies
      loadHistory();
    };
    
    // Lưu thiết lập hiện tại vào lịch sử
    function saveToHistory() {
      if (!getCookie("cookiesAccepted")) {
        alert("Vui lòng chấp nhận cookie để sử dụng tính năng lưu lịch sử");
        document.getElementById("cookieNotice").style.display = "block";
        return;
      }
      
      const content = document.getElementById("limitedContent").value;
      const keyword = document.getElementById("keyword").value;
      const link = document.getElementById("link").value;
      const limit = document.getElementById("linkLimit").value;
      
      if (!content || !keyword || !link) {
        alert("Vui lòng nhập đầy đủ nội dung, từ khóa và liên kết!");
        return;
      }
      
      // Lấy lịch sử hiện tại
      let history = getHistory();
      
      // Tạo mục mới với thời gian hiện tại
      const newItem = {
        content: content,
        keyword: keyword,
        link: link,
        limit: limit,
        timestamp: new Date().toISOString()
      };
      
      // Thêm vào đầu mảng
      history.unshift(newItem);
      
      // Giới hạn chỉ lưu tối đa 10 mục
      if (history.length > 10) {
        history = history.slice(0, 10);
      }
      
      // Lưu vào cookie
      saveHistory(history);
      
      // Cập nhật giao diện
      displayHistory(history);
      
      alert("Đã lưu thiết lập vào lịch sử!");
    }
    
    // Lấy lịch sử từ cookie
    function getHistory() {
      const historyCookie = getCookie("inputHistory");
      if (historyCookie) {
        try {
          return JSON.parse(historyCookie);
        } catch (e) {
          console.error("Lỗi khi phân tích lịch sử:", e);
          return [];
        }
      }
      return [];
    }
    
    // Lưu lịch sử vào cookie
    function saveHistory(history) {
      setCookie("inputHistory", JSON.stringify(history), 30); // Lưu trong 30 ngày
    }
    
    // Tải và hiển thị lịch sử
    function loadHistory() {
      const history = getHistory();
      displayHistory(history);
    }
    
    // Hiển thị lịch sử trên giao diện
    function displayHistory(history) {
      const historyContainer = document.getElementById("historyItems");
      historyContainer.innerHTML = "";
      
      if (history.length === 0) {
        historyContainer.innerHTML = "<p>Chưa có lịch sử nào được lưu.</p>";
        return;
      }
      
      history.forEach((item, index) => {
        const date = new Date(item.timestamp);
        const formattedDate = date.toLocaleDateString() + " " + date.toLocaleTimeString();
        
        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        historyItem.innerHTML = `
          <div>
            <strong>${item.keyword}</strong> → ${item.link}
            <div class="history-date">${formattedDate}</div>
          </div>
          <div>
            <button onclick="loadFromHistory(${index})">Chọn</button>
            <button onclick="removeHistoryItem(${index})">Xóa</button>
          </div>
        `;
        
        historyContainer.appendChild(historyItem);
      });
    }
    
    // Tải dữ liệu từ lịch sử vào form
    function loadFromHistory(index) {
      const history = getHistory();
      const item = history[index];
      
      if (item) {
        document.getElementById("limitedContent").value = item.content;
        document.getElementById("keyword").value = item.keyword;
        document.getElementById("link").value = item.link;
        document.getElementById("linkLimit").value = item.limit;
        
        // Tự động tạo liên kết
        generateLinks();
      }
    }
    
    // Xóa một mục khỏi lịch sử
    function removeHistoryItem(index) {
      let history = getHistory();
      
      if (confirm("Bạn có chắc muốn xóa mục này khỏi lịch sử?")) {
        history.splice(index, 1);
        saveHistory(history);
        displayHistory(history);
      }
    }
    
    // Xóa toàn bộ lịch sử
    function clearHistory() {
      if (confirm("Bạn có chắc muốn xóa tất cả lịch sử?")) {
        saveHistory([]);
        displayHistory([]);
      }
    }
    
    // Chấp nhận cookie
    function acceptCookies() {
      setCookie("cookiesAccepted", "true", 365);
      document.getElementById("cookieNotice").style.display = "none";
    }
    
    // Hàm thiết lập cookie
    function setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }
    
    // Hàm lấy giá trị cookie
    function getCookie(name) {
      const cookieName = name + "=";
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        let cookie = cookies[i].trim();
        if (cookie.indexOf(cookieName) === 0) {
          return cookie.substring(cookieName.length, cookie.length);
        }
      }
      return "";
    }
    
    // Hàm thay thế tối đa 'limit' lần xuất hiện của từ khóa  
    function replaceLimited(content, keyword, replacement, limit) {  
      if (!keyword) return content;
      let count = 0;  
      return content.replace(new RegExp(escapeRegExp(keyword), 'g'), function(match) {  
        if (count < limit) {  
          count++;  
          return replacement;  
        }  
        return match;  
      });  
    }
    
    // Hàm escape các ký tự đặc biệt trong regex
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function generateLinks() {  
      let limitedContent = document.getElementById("limitedContent").value;  
      let keyword = document.getElementById("keyword").value;  
      let link = document.getElementById("link").value;  
      let maxLimit = parseInt(document.getElementById("linkLimit").value) || 2;
      
      if (!limitedContent || !keyword || !link) {
        alert("Vui lòng nhập đầy đủ nội dung, từ khóa và liên kết!");
        return;
      }
      
      // Tạo định dạng liên kết cho các định dạng  
      let htmlLink = '<a href="' + link + '">' + keyword + '</a>';  
      let markdownLink = '[' + keyword + '](' + link + ')';  
      let bbcodeLink = '[url=' + link + ']' + keyword + '[/url]';  
      let plainLink = link;  
      
      // Xử lý nội dung - thay thế tối đa theo số lượng đã cấu hình
      let newContentHtml = replaceLimited(limitedContent, keyword, htmlLink, maxLimit);  
      let newContentMarkdown = replaceLimited(limitedContent, keyword, markdownLink, maxLimit);  
      let newContentBbcode = replaceLimited(limitedContent, keyword, bbcodeLink, maxLimit);  
      let newContentPlain = replaceLimited(limitedContent, keyword, plainLink, maxLimit);  
      
      // Hiển thị kết quả dạng code cho từng định dạng  
      document.getElementById("htmlCodeOutput").textContent = newContentHtml;  
      document.getElementById("markdownCodeOutput").textContent = newContentMarkdown;  
      document.getElementById("bbcodeCodeOutput").textContent = newContentBbcode;  
      document.getElementById("plainCodeOutput").textContent = newContentPlain;  
      
      // Cập nhật phần xem trước
      document.getElementById("previewContent").innerHTML = newContentHtml;
    }  

    function copyCode(elementId, btnId) {  
      let codeElement = document.getElementById(elementId);  
      let codeText = codeElement.textContent;  
      let copyBtn = document.getElementById(btnId);  
      
      if (navigator.clipboard && window.isSecureContext) {  
          navigator.clipboard.writeText(codeText)  
          .then(() => {  
              // Thay đổi nội dung nút khi copy thành công  
              let originalText = copyBtn.textContent;  
              copyBtn.textContent = 'Đã copy';  
              // Sau 2 giây, trả lại nội dung ban đầu  
              setTimeout(() => { copyBtn.textContent = originalText; }, 2000);  
          })  
          .catch(err => console.error('Copy thất bại: ', err));  
      } else {  
          let textArea = document.createElement("textarea");  
          textArea.value = codeText;  
          textArea.style.position = "fixed";  
          textArea.style.left = "-999999px";  
          textArea.style.top = "-999999px";  
          document.body.appendChild(textArea);  
          textArea.focus();  
          textArea.select();  
          
          try {  
              document.execCommand('copy');  
              let originalText = copyBtn.textContent;  
              copyBtn.textContent = 'Đã copy';  
              setTimeout(() => { copyBtn.textContent = originalText; }, 2000);  
          } catch (err) {  
              console.error('Copy thất bại: ', err);  
          }  
          document.body.removeChild(textArea);  
      }  
    }
    
    // Chức năng chuyển đổi tab
    function switchTab(tabName) {
      // Ẩn tất cả tab content và hủy active
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(tab => tab.classList.remove('active'));
      
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Hiển thị tab được chọn
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Kích hoạt tab được chọn
      const selectedTab = Array.from(tabs).find(tab => 
        tab.textContent.toLowerCase() === tabName.toLowerCase());
      if (selectedTab) {
        selectedTab.classList.add('active');
      }
    }
    
    // Chức năng chuyển đổi chế độ tối
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }
  </script>  
</body>  
</html>  
